import{_,s as v,r as h,j as k,c as o,D as y,b as B,a as e,F,k as S,o as l,t as u,v as L,C as V}from"./DV93emuu.js";import{A as C,a as D}from"./72y5wB-v.js";import{c as E}from"./ibMq-yxt.js";const H={key:1},N={class:"admin-table"},A=["href"],K={key:1},z=["onUpdate:modelValue","onChange"],x=["onClick"],G={__name:"admin-bewerbung",setup(M){const d=v(),r=E(d.public.supabaseUrl,d.public.supabaseAnonKey),i=h(!1),c=h([]);k(async()=>{const{data:{session:a}}=await r.auth.getSession();i.value=!!a,i.value&&m()});function f(){i.value=!0,m()}const m=async()=>{const{data:a,error:t}=await r.from("bewerbungen").select("*");t?console.error("Fehler beim Laden der Bewerbungen:",t):c.value=a},p=async()=>{await r.auth.signOut(),i.value=!1},b=async(a,t)=>{const{error:n}=await r.from("bewerbungen").update({status:t}).eq("id",a);if(n){alert("Fehler beim Aktualisieren des Status");return}if(t==="angenommen"){const{data:s,error:g}=await r.from("bewerbungen").select("email, Vorname").eq("id",a).single();if(g){console.error("Fehler beim Laden der Bewerbung:",g);return}(await fetch("/api/send-mail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:s.email,subject:"Zusage für deinen Studienplatz an der FH Kiel",text:`Hallo ${s.Vorname},

herzlichen Glückwunsch! Deine Bewerbung wurde angenommen. Wir freuen uns, dich an der FH Kiel begrüßen zu dürfen.

Beste Grüße
Dein FH Kiel Team`,html:`<p>Hallo ${s.Vorname},</p><p>herzlichen Glückwunsch! Deine Bewerbung wurde angenommen. Wir freuen uns, dich an der FH Kiel begrüßen zu dürfen.</p><p>Beste Grüße<br/>Dein FH Kiel Team</p>`})})).ok||console.error("Fehler beim Versenden der Email")}},w=async a=>{if(!confirm("Eintrag wirklich löschen?"))return;const{error:t}=await r.from("bewerbungen").delete().eq("id",a);t?alert("Fehler beim Löschen"):c.value=c.value.filter(n=>n.id!==a)};return(a,t)=>(l(),o("div",null,[i.value?(l(),o("div",H,[B(C,{onLogout:p}),t[2]||(t[2]=e("h2",{class:"section-title"},"Eingegangene Bewerbungen",-1)),e("table",N,[t[1]||(t[1]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Email"),e("th",null,"Studiengang"),e("th",null,"Zeugnis"),e("th",null,"Nachricht"),e("th",null,"Status"),e("th",null,"Aktionen")])],-1)),e("tbody",null,[(l(!0),o(F,null,S(c.value,n=>(l(),o("tr",{key:n.id},[e("td",null,u(n.Vorname)+" "+u(n.nachname),1),e("td",null,u(n.email),1),e("td",null,u(n.studiengang),1),e("td",null,[n.Zeugnisse_url?(l(),o("a",{key:0,href:n.Zeugnisse_url,target:"_blank"},"PDF öffnen",8,A)):(l(),o("span",K,"-"))]),e("td",null,u(n.Nachricht),1),e("td",null,[L(e("select",{"onUpdate:modelValue":s=>n.status=s,onChange:s=>b(n.id,n.status)},t[0]||(t[0]=[e("option",{value:"neu"},"neu",-1),e("option",{value:"angenommen"},"angenommen",-1),e("option",{value:"abgelehnt"},"abgelehnt",-1)]),40,z),[[V,n.status]])]),e("td",null,[e("button",{onClick:s=>w(n.id),class:"btn-delete"},"Löschen",8,x)])]))),128))])])])):(l(),y(D,{key:0,onLoginSuccess:f}))]))}},q=_(G,[["__scopeId","data-v-bcd6e4d6"]]);export{q as default};
